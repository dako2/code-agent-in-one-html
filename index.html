<!doctype html><meta charset="utf-8"><title>Gemini 2.5 â€” Mini Editor + Memory</title><meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--b:#e5e7eb;--mut:#6b7280}*{box-sizing:border-box}html,body{height:100%}
body{margin:0;font:13px ui-monospace,monospace;display:flex;flex-direction:column}
header{display:flex;gap:.5rem;align-items:center;padding:.5rem;border-bottom:1px solid var(--b);background:#fafafa;flex-wrap:wrap}
input,button,textarea{border:1px solid var(--b);background:#fff;border-radius:6px;padding:.35rem .55rem}
button{cursor:pointer}button:hover{background:#f3f4f6}label{display:flex;align-items:center;gap:.35rem}
#wrap{flex:1;display:grid;grid-template-rows:1fr 35vh}
#editor{border:0;border-bottom:1px solid var(--b);padding:10px;resize:none;outline:none}
#chatbox{display:flex;flex-direction:column;overflow:hidden}#chat{flex:1;overflow:auto;padding:8px}
#prompt{min-height:60px;resize:vertical}
.m{margin:.35rem 0;padding:.45rem .6rem;border:1px solid var(--b);border-radius:8px;white-space:pre-wrap;word-break:break-word}
.me{background:#eef4ff}.bot{background:#f6fff2}.err{background:#fff1f2}small{color:var(--mut)}
</style>
<header>
  <input id="key" type="password" placeholder="Google AI API Key" style="min-width:240px">
  <button id="send">Send</button>
  <label><input id="memOn" type="checkbox" checked>ðŸ§  Memory <small id="memStat">(0)</small></label>
  <button id="clearMem" title="/clear-mem does the same">Clear Mem</button>
  <small>âŒ˜/Ctrl+Enter â€¢ sessionStorage</small>
</header>
<div id="wrap">
  <textarea id="editor" placeholder="Paste or write code hereâ€¦" spellcheck="false"></textarea>
  <div id="chatbox">
    <div id="chat"><div class="m">Paste your key, then ask. Commands: <b>/remember fact</b>, <b>/mem</b>, <b>/clear-mem</b>.</div></div>
    <textarea id="prompt" placeholder="Ask Gemini 2.5 Flash about your codeâ€¦"></textarea>
  </div>
</div>
<script type="module">
import { GoogleGenerativeAI as G } from 'https://esm.run/@google/generative-ai';
const $=q=>document.querySelector(q),K=$('#key'),E=$('#editor'),P=$('#prompt'),C=$('#chat'),ON=$('#memOn'),S=$('#memStat'),CLR=$('#clearMem'),MK='mini_mem_v1';
K.value=sessionStorage.getItem('g_api_key')||'';K.oninput=()=>sessionStorage.setItem('g_api_key',K.value.trim());
const add=(cls,t)=>{const d=document.createElement('div');d.className=`m ${cls}`;d.textContent=t;C.appendChild(d);C.scrollTop=C.scrollHeight};
class M{constructor(){const j=sessionStorage.getItem(MK);const x=j?JSON.parse(j):{facts:[],turns:[]};this.facts=x.facts;this.turns=x.turns;this.keep=20}
 save(){sessionStorage.setItem(MK,JSON.stringify({facts:this.facts,turns:this.turns.slice(-this.keep)}));S.textContent=`(${this.facts.length+this.turns.length})`}
 clear(){this.facts=[];this.turns=[];this.save()}
 fact(t){t=t.trim();if(t)this.facts.push(t),this.save()}
 turn(q,a){this.turns.push({q,a,ts:Date.now()});this.save()}
 recall(b=4000){const p=[];if(this.facts.length)p.push('FACTS:\n'+this.facts.map(f=>'- '+f).join('\n'));let u=p.join('\n\n').length;
 for(let i=Math.max(0,this.turns.length-this.keep);i<this.turns.length;i++){const t=this.turns[i],blk=`Q: ${t.q}\nA: ${t.a}`;if(u+blk.length+2>b)break;p.push(blk);u+=blk.length+2}
 return p.join('\n\n')}
}
const mem=new M();mem.save();
const MODEL='gemini-2.5-flash';
async function ask(q){
  const k=K.value.trim(); if(!k) throw new Error('API key required.');
  const m=new G(k).getGenerativeModel({model:MODEL});
  const txt=`You are a concise coding assistant.\n\nCONTEXT:\n---\n${E.value.slice(0,12000)}\n---\n\nMEMORY:\n---\n${mem.recall(4000)||'(none)'}\n---\n\nQUESTION:\n${q}`;
  const r=await m.generateContent({contents:[{role:'user',parts:[{text:txt}]}],generationConfig:{temperature:.3}});
  return r?.response?.text()||'(no response)';
}
function cmd(q){
  if(q.startsWith('/remember ')) return mem.fact(q.slice(10)),add('bot','âœ… Remembered.'),1;
  if(q==='/mem') return add('bot',mem.recall(8000)||'(empty)'),1;
  if(q==='/clear-mem') return mem.clear(),add('bot','ðŸ§¹ Memory cleared.'),1;
}
async function send(){
  const q=P.value.trim(); if(!q) return;
  add('me',q); P.value='';
  if(cmd(q)) return;
  try{const a=await ask(q); add('bot',a); if(ON.checked) mem.turn(q,a)}
  catch(e){add('err',e?.message||'Request failed')}
}
$('#send').onclick=send;
addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==='enter'){e.preventDefault();send()}});
CLR.onclick=()=>{mem.clear();add('bot','ðŸ§¹ Memory cleared.')};
</script>
